define(["jquery","underscore","backbone","collection/todos","view/todo","text!tmpl/stat.handlebars","common/handlebars","common/common"],function(t,e,i,s,n,o,r,l){"use strict";var h=i.View.extend({el:"#todoapp",template:r.compile(o),events:{"keypress #search":"search","click #new-todo":"createOnEnter","click #clear-completed":"clearDone","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0],this.$input=this.$("#search"),this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.$todolist=this.$(".todo-list"),this.$todoList=this.$("#todo-list"),this.listenTo(s,"add",this.addOne),this.listenTo(s,"reset",this.addAll),this.listenTo(s,"change:done",this.filterOne),this.listenTo(s,"filter",this.filterAll),this.listenTo(s,"all",this.render),s.fetch({reset:!0})},render:function(){var t=this.filtered||s,e=t.done().length,i=t.remaining().length;t.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.template({done:e,remaining:i})),this.$("#filters li a").removeClass("selected").filter('[href="#/'+(l.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!i},addOne:function(t){var e=new n({model:t});this.$todoList.append(e.render().el)},addAll:function(){var t=this.filtered||s;this.$todoList.empty(),t.each(this.addOne,this)},filterOne:function(t){t.trigger("visible")},filterAll:function(){var t=this.filtered||s;t.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:s.nextOrder(),done:!1}},createOnEnter:function(){this.$input.val(""),this.doSearch(),s.create(this.newAttributes()),s.sort()},search:function(t){if(this.searchTimer&&clearTimeout(this.searchTimer),t.which!==l.ENTER_KEY){var e=this;return this.searchTimer=setTimeout(function(){e.doSearch()},500),void 0}this.doSearch()},doSearch:function(){var t=this.$input.val().trim();!t||t.length<3?this.filtered=null:(this.filtered=s.search(t),this.$input.blur()),this.addAll(),this.render()},clearDone:function(){return e.invoke(s.done(),"destroy"),!1},toggleAllComplete:function(){var t=this.allCheckbox.checked;s.each(function(e){e.save({done:t})})}});return h});